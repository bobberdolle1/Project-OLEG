# Changelog

–í—Å–µ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

–§–æ—Ä–º–∞—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
–ø—Ä–æ–µ–∫—Ç –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è [Semantic Versioning](https://semver.org/lang/ru/).

---

## [9.0.0] - 2025-01-27

### üßπ Simplified Edition ‚Äî –ú–∞–∂–æ—Ä–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Ñ–æ–∫—É—Å–∞ –Ω–∞ AI –∏ –∏–≥—Ä–∞—Ö.

#### üß† Smart Memory Fix

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ç–æ—á–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ RAG:**
- `app/handlers/topic_listener.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ `is_message_relevant()`
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≥–¥–µ –±–æ—Ç —É–ø–æ–º—è–Ω—É—Ç, —ç—Ç–æ –µ–≥–æ –æ—Ç–≤–µ—Ç, —Ä–µ–ø–ª–∞–π –Ω–∞ –Ω–µ–≥–æ, –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –¥–∏–∞–ª–æ–≥–µ (5 –º–∏–Ω—É—Ç)

**–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π:**
- `app/services/ollama_client.py` ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –≤ `default_knowledge` —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `extract_search_terms()` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –£–±—Ä–∞–Ω—ã –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã –ø—Ä–æ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã –≤ –æ–±—ã—á–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–æ—Å—å–µ /whois —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤ —Å –±–æ—Ç–æ–º
- –ü—Ä–æ—Ñ–∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —É–ø–æ–º–∏–Ω–∞–ª

#### ‚ú® –£–ª—É—á—à–µ–Ω–∏—è AI

**–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å –æ–±—â–µ–Ω–∏—è:**
- –£—Å–∏–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç prompt injection —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
- –î–æ–±–∞–≤–ª–µ–Ω—ã —è–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–æ–ø–æ–¥–æ–±–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
- –ó–∞–ø—Ä–µ—Ç —Ñ—Ä–∞–∑ —Ç–∏–ø–∞ "—è –ø–æ–º–æ–≥—É", "—á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å", "—Ä–∞–¥ –ø–æ–º–æ—á—å"
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–æ–≤ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, 4-5 –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö)
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç: 250 —Ç–æ–∫–µ–Ω–æ–≤ (~5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –º–∞–∫—Å–∏–º—É–º)
- –û–ª–µ–≥ —Ç–µ–ø–µ—Ä—å –æ–±—â–∞–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ, –∞ –Ω–µ –∫–∞–∫ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç

#### ‚ùå –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**Handlers (4 —Ñ–∞–π–ª–∞):**
- `app/handlers/moderation.py` ‚Äî –∫–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `app/handlers/antiraid.py` ‚Äî –∞–Ω—Ç–∏—Ä–µ–π–¥ —Å–∏—Å—Ç–µ–º–∞
- `app/handlers/citadel.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DEFCON
- `app/handlers/private_admin.py` ‚Äî –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ –õ–°

**Services (9 —Ñ–∞–π–ª–æ–≤):**
- `app/services/citadel.py` ‚Äî DEFCON protection system
- `app/services/toxicity_analyzer.py` ‚Äî AI-–∞–Ω–∞–ª–∏–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `app/services/spam_classifier.py` ‚Äî –Ω–µ–π—Ä–æ-—Å–ø–∞–º —Ñ–∏–ª—å—Ç—Ä
- `app/services/permission_checker.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞
- `app/services/protection_profiles.py` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞—â–∏—Ç—ã
- `app/services/security.py` ‚Äî security utilities
- `app/services/panic_mode.py` ‚Äî –∞–≤—Ç–æ–∑–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–π–¥–æ–≤
- `app/services/admin_panel.py` ‚Äî –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–µ—Ä–≤–∏—Å
- `app/services/notifications.py` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞–º

**Middleware (6 —Ñ–∞–π–ª–æ–≤):**
- `app/middleware/defcon_filter.py` ‚Äî DEFCON —Ñ–∏–ª—å—Ç—Ä
- `app/middleware/spam_filter.py` ‚Äî —Å–ø–∞–º-–ø–∞—Ç—Ç–µ—Ä–Ω—ã
- `app/middleware/spam_control.py` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
- `app/middleware/toxicity_analysis.py` ‚Äî –∞–Ω–∞–ª–∏–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `app/middleware/toxicity_filter.py` ‚Äî —Ñ–∏–ª—å—Ç—Ä —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `app/middleware/blacklist_filter.py` ‚Äî —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫

**–¢–∞–±–ª–∏—Ü—ã –ë–î (13 —Ç–∞–±–ª–∏—Ü):**
- `warnings` ‚Äî –≤–∞—Ä–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `toxicity_logs` ‚Äî –ª–æ–≥–∏ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `toxicity_configs` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `moderation_configs` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `citadel_configs` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Citadel
- `user_reputations` ‚Äî —Ä–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `reputation_history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
- `spam_patterns` ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–ø–∞–º–∞
- `blacklist` ‚Äî —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
- `security_blacklist` ‚Äî security blacklist
- `rate_limits` ‚Äî rate limit tracking
- `protection_profile_config` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞—â–∏—Ç—ã
- `silent_bans` ‚Äî —Ç–∏—Ö–∏–µ –±–∞–Ω—ã

**–ü–æ–ª—è –º–æ–¥–µ–ª–µ–π:**
- `User.strikes` ‚Äî —Å—Ç—Ä–∞–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `Chat.defcon_level` ‚Äî —É—Ä–æ–≤–µ–Ω—å DEFCON
- `Chat.owner_notifications_enabled` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É
- `Chat.moderation_mode` ‚Äî —Ä–µ–∂–∏–º –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `NotificationConfig.raid_alert` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–µ–π–¥–µ
- `NotificationConfig.ban_notification` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –±–∞–Ω–µ
- `NotificationConfig.toxicity_warning` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
- `NotificationConfig.defcon_recommendation` ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è DEFCON
- `NotificationConfig.repeated_violator` ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –Ω–∞—Ä—É—à–∏—Ç–µ–ª—å

#### ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/main.py` ‚Äî —É–¥–∞–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ middleware/handlers –º–æ–¥–µ—Ä–∞—Ü–∏–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω admin_dashboard_router
- `app/database/models.py` ‚Äî —É–¥–∞–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –∏ –ø–æ–ª—è
- `app/handlers/qna.py` ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏ –∑–∞–≥–ª—É—à–µ–Ω–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.0)
- `app/handlers/gif_patrol.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ citadel –∑–∞–≥–ª—É—à–µ–Ω–∞ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False)
- `app/handlers/help.py` ‚Äî —É–¥–∞–ª—ë–Ω —Ä–∞–∑–¥–µ–ª HELP_MODERATION –∏ –∫–Ω–æ–ø–∫–∞ "üõ° –ú–æ–¥–µ—Ä–∞—Ü–∏—è"
- `app/handlers/owner_panel.py` ‚Äî —É–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏, moderation_mode, toxicity_threshold
- `app/handlers/admin_dashboard.py` ‚Äî —É–¥–∞–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (DEFCON, –±–∞–Ω—Ö–∞–º–º–µ—Ä, –ß–°), —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã "–ü–æ–≤–µ–¥–µ–Ω–∏–µ", "–î–µ–π—Å—Ç–≤–∏—è", "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
- `app/services/dailies.py` ‚Äî –∑–∞–≥–ª—É—à–µ–Ω—ã –∑–∞–ø—Ä–æ—Å—ã ToxicityLog (–≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 0)
- `migrations/versions/20250127_remove_moderation_system.py` ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü

#### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–£–¥–∞–ª–µ–Ω–æ:** 19 —Ñ–∞–π–ª–æ–≤, 13 —Ç–∞–±–ª–∏—Ü –ë–î, 9 –ø–æ–ª–µ–π –º–æ–¥–µ–ª–µ–π
- **–£–ø—Ä–æ—â–µ–Ω–æ:** main.py (-50 —Å—Ç—Ä–æ–∫), models.py (-300 —Å—Ç—Ä–æ–∫)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ß–∏—â–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –±—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞

#### üéØ –ü—Ä–∏—á–∏–Ω—ã —É–¥–∞–ª–µ–Ω–∏—è

1. **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è–ª–∞ 19 —Ñ–∞–π–ª–æ–≤ –∏ 13 —Ç–∞–±–ª–∏—Ü
2. **–ù–∏–∑–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** ‚Äî DEFCON –∏ –∞–Ω—Ç–∏—Ä–µ–π–¥ —Ä–µ–¥–∫–æ –ø—Ä–∏–º–µ–Ω—è–ª–∏—Å—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ
3. **–§–æ–∫—É—Å –Ω–∞ AI** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å –±–æ—Ç–∞ –≤ LLM –∏ –∏–≥—Ä–∞—Ö, –Ω–µ –≤ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
4. **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏** ‚Äî –º–µ–Ω—å—à–µ –∫–æ–¥–∞ = –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤ –∏ –ø—Ä–æ—â–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### ‚ö†Ô∏è Breaking Changes

- –ö–æ–º–∞–Ω–¥—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç: `–æ–ª–µ–≥ defcon`, `/ban`, `/mute`, `/warn`
- –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (`app/handlers/private_admin.py`) —É–¥–∞–ª–µ–Ω–∞
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å `/admin` —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞, –Ω–æ –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏ (DEFCON, –±–∞–Ω—Ö–∞–º–º–µ—Ä, –ß–°)
- DEFCON —É—Ä–æ–≤–Ω–∏ –±–æ–ª—å—à–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ—Ç–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –æ —Ä–µ–π–¥–∞—Ö/–±–∞–Ω–∞—Ö –æ—Ç–∫–ª—é—á–µ–Ω—ã
- –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–¥–∞–ª–µ–Ω–∞

#### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü
alembic upgrade head
```

**–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ –∏–∑ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã. –°–¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

---

