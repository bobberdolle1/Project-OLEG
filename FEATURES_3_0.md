# Особенности версии 3.0: "Олег 3.0 - Самоуправляемый ИИ-модератор"

Версия 3.0 представляет собой радикальное обновление бота "Олег", превращающее его из простого модератора в полноценного ИИ-участника сообщества. Основной фокус сделан на автономности, адаптивности и умении бота самостоятельно настраиваться и взаимодействовать с сообществом.

## 1. Система "Plug & Play" (Контекстное подключение)

### Автоматическое определение типа чата
- Бот автоматически определяет тип чата при добавлении: группа, супергруппа (с топиками), приват
- Сохраняет информацию о чате в базе данных с автоматической генерацией уникального ID

### Сканирование контекста
- Бот анализирует описание чата, закрепленные сообщения и другие артефакты
- На основе контекста автоматически генерируется индивидуальный системный промпт для этого чата
  - *Пример:* В чате про оверклок → промпт "Используй технический жаргон и термины"
  - *Пример:* В чате про политику → промпт "Избегай обсуждения политики, перенаправляй к теме чата"

### Автоматическая инициализация
- При добавлении в чат бот сразу начинает работать без необходимости ручной настройки
- Не требует указания ID чата в `.env` или через веб-панель
- Создает уникальную конфигурацию для каждого чата на основе контекста

## 2. Умное приветствие пользователей

### Система подтверждения "Я не бот"
- При присоединении нового участника бот удаляет системное сообщение "Пользователь присоединился"
- Отправляет пользовательское приветствие с кнопкой "Я не бот / Прочитал правила"
- Если кнопка не нажата в течение 5 минут, пользователь кикается
- Защита от автоматических аккаунтов и спам-ботов

### Индивидуальные приветствия
- Приветствие генерируется с учетом контекста чата
- Стиль адаптируется под тематику (железо, игры, общее общение)
- Использует характер Олега - грубоват, но информативен

## 3. "Мозг Олега" (RAG - Retrieval Augmented Generation)

### Векторное хранилище знаний
- Использует ChromaDB для хранения и поиска информации
- Бот запоминает факты о пользователях, правила чата и важные события
- *Пример:* "У @user1 процессор 13900K" сохраняется как знание
- *Пример:* "В чате запрещено обсуждать политику" сохраняется как правило

### Контекстный поиск
- При ответе на вопросы бот ищет релевантные знания в базе
- Интегрирует найденные факты в контекст перед генерацией ответа
- *Пример:* Пользователь спрашивает "@oleg, что у user1 за процессор?" → бот отвечает "13900K"

### Автообучение
- Бот автоматически извлекает факты из сообщений (с помощью LLM)
- Сохраняет полезные знания в векторной базе
- Обновляет базу знаний на регулярной основе

## 4. Модуль зрения (Vision Module)

### Анализ изображений
- Бот распознает изображения с помощью мультимодальной модели Ollama
- Понимает текст на скриншотах, диаграммах, фотографиях
- Отвечает на вопросы по содержимому изображений

### Сценарии использования
- *Скрин ошибки:* Пользователь кидает скрин ошибки → бот описывает проблему и предлагает решение
- *Сборка железа:* Пользователь присылает фото своего ПК → бот комментирует (в стиле Олега)
- *Мемы и цитаты:* Бот распознает и может включить изображение в коллекцию мемов

## 5. Рандомные ответы

### Автоматические реплики
- Бот сам вставляет реплики в чат (с вероятностью ~2% на сообщение)
- Учитывает текущий контекст и активность пользователей
- При упоминании тем, которые бот "помнит" (например, срачи про Intel), вероятность повышается

### Адаптивное поведение
- Стиль рандомных ответов зависит от токсичности в чате
- В токсичном чате бот становится более язвительным
- В дружелюбном - более вежливым (но все равно с характером Олега)

## 6. Администрирование через личные сообщения

### Панель управления в ЛС
- Полноценная админ-панель доступна через команду `/admin` в ЛС
- Интерактивное меню с inline-кнопками
- Управление чатами, админами, черным списком, настройками

### Функции админ-панели
- **Статистика:** Кол-во пользователей, сообщений, активность
- **Управление чатами:** Просмотр, настройка промптов, режимов
- **Администраторы:** Добавление/удаление, права
- **Черный список:** Локальные и глобальные баны
- **Настройки:** Тонкая настройка поведения бота
- **Логи:** Просмотр, экспорт, очистка

### Модерация через ЛС
- Бот присылает модераторам уведомления о нарушениях
- Возможность быстро банить/мутить пользователей прямо из ЛС
- Просмотр контекста нарушения (вся переписка с пользователем)

## 7. Обновленная документация

### Внутри-бот документация
- Команда `/help` адаптируется под тип пользователя (админ/обычный)
- Описание всех возможностей с примерами
- Интерактивные разделы с кнопками

### Актуализация документации
- Обновлены README.md, USER_GUIDE.md
- Добавлен файл FEATURES_3_0.md (этот файл)
- Обновлены примеры конфигурации и переменные окружения

## 8. Архитектурные изменения

### Удаление веб-панели
- Веб-админка удалена в пользу системы управления через ЛС
- Упрощение архитектуры, безопасность, удобство

### Новые зависимости
- ChromaDB для RAG
- Мультимодальная модель Ollama
- Новые зависимости для векторного поиска

### Повышенная безопасность
- Улучшена защита от промпт-инъекций
- Надежная система аутентификации админов
- Более строгая валидация входных данных

---

*Этот документ описывает основные изменения в версии 3.0. Для деталей о конкретных реализациях смотрите исходный код и файлы документации.*