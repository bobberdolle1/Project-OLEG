"""Help command handler."""

import logging
from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message

logger = logging.getLogger(__name__)

router = Router()


# Help text for group chats - focuses on games, moderation, and group features
HELP_TEXT_GROUP = """
ü§ñ <b>–û–ª–µ–≥ ‚Äî –¢–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –≥–∏–≥–∞—á–∞–¥</b>

<b>üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≥—Ä—É–ø–ø—ã:</b>

<b>üéÆ –ò–≥—Ä—ã:</b>
/games ‚Äî <b>–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ –∏–≥—Ä–∞–º –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤!</b>
/grow ‚Äî –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä (–∫—É–ª–¥–∞—É–Ω 12-24—á)
/top ‚Äî –¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ —Ä–∞–∑–º–µ—Ä—É
/top_rep ‚Äî –¢–æ–ø-10 –ø–æ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
/profile ‚Äî –¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
/pvp @username ‚Äî –î—É—ç–ª—å —Å –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–æ–º
/casino [—Å—Ç–∞–≤–∫–∞] ‚Äî –°–ª–æ—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –º–æ–Ω–µ—Ç)

üí° <i>–ù–æ–≤–∏—á–æ–∫? –ù–∞–ø–∏—à–∏ /games –∏–ª–∏ —Å–ø—Ä–æ—Å–∏ "–ø–æ–º–æ–≥–∏ —Å –∏–≥—Ä–∞–º–∏"!</i>

<b>–ì–∏–ª—å–¥–∏–∏:</b>
/create_guild [–Ω–∞–∑–≤–∞–Ω–∏–µ] ‚Äî –°–æ–∑–¥–∞—Ç—å –≥–∏–ª—å–¥–∏—é
/join_guild [–Ω–∞–∑–≤–∞–Ω–∏–µ] ‚Äî –í—Å—Ç—É–ø–∏—Ç—å –≤ –≥–∏–ª—å–¥–∏—é
/leave_guild ‚Äî –ü–æ–∫–∏–Ω—É—Ç—å –≥–∏–ª—å–¥–∏—é
/guild_info ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–≤–æ–µ–π –≥–∏–ª—å–¥–∏–∏
/guild_war @–≥–∏–ª—å–¥–∏—è [—á–∞—Å—ã] ‚Äî –û–±—ä—è–≤–∏—Ç—å –≤–æ–π–Ω—É

<b>–î—É—ç—Ç—ã:</b>
/create_duo @–ø–∞—Ä—Ç–Ω–µ—Ä ‚Äî –°–æ–∑–¥–∞—Ç—å –¥—É—ç—Ç
/duo_stats ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—É—ç—Ç–∞
/duo_pvp @–¥—É—ç—Ç ‚Äî –î—É—ç–ª—å –¥—É—ç—Ç–æ–≤

<b>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –∫–≤–µ—Å—Ç—ã:</b>
/achievements ‚Äî –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
/my_achievements ‚Äî –¢–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
/quests ‚Äî –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
/quest_progress ‚Äî –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–≤–µ—Å—Ç–∞–º

<b>–ú–æ–¥–µ—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤):</b>
–æ–ª–µ–≥ –±–∞–Ω @user [–≤—Ä–µ–º—è] [–ø—Ä–∏—á–∏–Ω–∞]
–æ–ª–µ–≥ –º—É—Ç @user [–≤—Ä–µ–º—è] [–ø—Ä–∏—á–∏–Ω–∞]
–æ–ª–µ–≥ –∫–∏–∫ @user [–ø—Ä–∏—á–∏–Ω–∞]
–æ–ª–µ–≥ —Ä–µ–∂–∏–º [light|normal|dictatorship]
/warn ‚Äî –í—ã–¥–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
/unwarn ‚Äî –°–Ω—è—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
/strikes ‚Äî –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

<b>–î—Ä—É–≥–æ–µ:</b>
/start ‚Äî –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
/help ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/say [—Ç–µ–∫—Å—Ç] ‚Äî –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –û–ª–µ–≥–∞
/—Å–æ–≤–µ—Ç—ã –∏–ª–∏ /tips ‚Äî –°–æ–≤–µ—Ç—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —á–∞—Ç–æ–º (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

<b>üí¨ Q&A:</b>
–£–ø–æ–º—è–Ω–∏ –º–µ–Ω—è ({bot_username}) –∏–ª–∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —è –æ—Ç–≤–µ—á—É!

<b>üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:</b>
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–∑ —á–∞—Ç–∞ (08:00 –ú–°–ö)
‚Ä¢ –ö—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (20:00 –ú–°–ö)
‚Ä¢ –ê–Ω—Ç–∏—Ä–∞–∏–¥ –∑–∞—â–∏—Ç–∞
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏
‚Ä¢ –°–ø–∞–º-—Ñ–∏–ª—å—Ç—Ä

<b>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞:</b>
–ù–∞–ø–∏—à–∏ –º–Ω–µ –≤ –ª–∏—á–∫—É /admin –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

<i>–Ø –∂–∏–≤—É –≤ —ç—Ç–æ–º —á–∞—Ç–µ. –≠—Ç–æ –º–æ—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è. –Ø –∑–¥–µ—Å—å –∑–∞–∫–æ–Ω.</i>
"""


# Help text for private chats - focuses on admin panel and personal commands
HELP_TEXT_PRIVATE = """
ü§ñ <b>–û–ª–µ–≥ ‚Äî –¢–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π –≥–∏–≥–∞—á–∞–¥</b>

<b>üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:</b>

<b>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</b>
/admin ‚Äî <b>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–≤–æ–∏–º–∏ —á–∞—Ç–∞–º–∏</b>
/reset ‚Äî –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞
/myhistory ‚Äî –ò—Å—Ç–æ—Ä–∏—è —Ç–≤–æ–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

<b>üîä –ì–æ–ª–æ—Å:</b>
/say [—Ç–µ–∫—Å—Ç] ‚Äî –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –û–ª–µ–≥–∞

<b>üìñ –°–ø—Ä–∞–≤–∫–∞:</b>
/start ‚Äî –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
/help ‚Äî –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞

<b>üí¨ Q&A:</b>
–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –º–Ω–µ ‚Äî —è –æ—Ç–≤–µ—á—É!

<b>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</b>
–ò—Å–ø–æ–ª—å–∑—É–π /admin —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–æ—Ç–∞ –≤ —Å–≤–æ–∏—Ö —á–∞—Ç–∞—Ö:
‚Ä¢ –†–µ–∂–∏–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
‚Ä¢ –ê–Ω—Ç–∏—Ä–∞–∏–¥ –∑–∞—â–∏—Ç–∞
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚Ä¢ –ò –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ!

<i>–í –ª–∏—á–∫–µ —è –¥–æ–±—Ä–µ–µ. –ù–æ –≤—Å—ë –µ—â—ë –≥–∏–≥–∞—á–∞–¥.</i>
"""


def get_help_text(chat_type: str, bot_username: str = "@bot") -> str:
    """
    Get appropriate help text based on chat type.
    
    Args:
        chat_type: Type of chat ('private', 'group', 'supergroup', etc.)
        bot_username: Bot's username for mentions
        
    Returns:
        Formatted help text for the given context
    """
    if chat_type == "private":
        return HELP_TEXT_PRIVATE
    else:
        return HELP_TEXT_GROUP.format(bot_username=bot_username)


@router.message(Command("help"))
async def cmd_help(msg: Message):
    """
    –ö–æ–º–∞–Ω–¥–∞ /help ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º.
    
    Shows context-appropriate help:
    - Private chat: admin panel, reset, personal commands
    - Group chat: games, moderation, group features
    
    Args:
        msg: –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    bot_username = f"@{msg.bot._me.username}" if msg.bot._me and msg.bot._me.username else "@bot"
    help_text = get_help_text(msg.chat.type, bot_username)
    await msg.reply(help_text, parse_mode="HTML")
    logger.info(f"Help requested by @{msg.from_user.username or msg.from_user.id} in {msg.chat.type} chat")
